<ResourceDictionary x:Class="AIWeather.Options"
                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:AIWeather"
                    xmlns:conv="clr-namespace:AIWeather.Converters">

    <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
    <conv:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter"/>
    
    <!-- Options View Template - must use key pattern: <PluginName>_Options -->
    <DataTemplate x:Key="AI Weather_Options">
        <StackPanel Orientation="Vertical" Margin="10" DataContext="{Binding}">

            <!-- Capture Mode -->
            <TextBlock Text="Capture Mode:" Margin="0,0,0,2" FontWeight="Bold"/>
            <ComboBox SelectedIndex="{Binding Options.CaptureModeIndex, Mode=TwoWay}"
                      Width="300" HorizontalAlignment="Left"
                      Margin="0,0,0,10">
                <ComboBoxItem Content="RTSP Stream (continuous video)"/>
                <ComboBoxItem Content="HTTP Image Download (from URL)"/>
                <ComboBoxItem Content="Folder Watch (monitor latest image)"/>
            </ComboBox>

            <!-- RTSP URL (visible when mode = 0) -->
            <StackPanel Margin="0,0,0,10">
                <StackPanel.Visibility>
                    <Binding Path="Options.CaptureMode" Converter="{StaticResource EnumToVisibilityConverter}" ConverterParameter="0"/>
                </StackPanel.Visibility>
                <TextBlock Text="RTSP Stream URL:" Margin="0,0,0,2"/>
                <TextBox Text="{Binding Options.RtspUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Width="300" HorizontalAlignment="Left"/>
                <TextBlock Text="Configure username/password in the AI Weather Monitor imaging tab" 
                           FontSize="10" Foreground="#AAAAAA" Margin="0,2,0,0"/>
            </StackPanel>

            <!-- HTTP Image Download (visible when mode = 1) -->
            <StackPanel Margin="0,0,0,10">
                <StackPanel.Visibility>
                    <Binding Path="Options.CaptureMode" Converter="{StaticResource EnumToVisibilityConverter}" ConverterParameter="1"/>
                </StackPanel.Visibility>
                <TextBlock Text="Image URL:" Margin="0,0,0,2"/>
                <TextBox Text="{Binding Options.INDIDeviceName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Width="300" HorizontalAlignment="Left"/>
                <TextBlock TextWrapping="Wrap" FontSize="10" Foreground="#AAAAAA" Margin="0,2,0,0" Width="300" HorizontalAlignment="Left">
                    <Run Text="Enter full URL to latest image"/>
                    <LineBreak/>
                    <Run Text="Example: http://192.168.1.100/image.jpg"/>
                    <LineBreak/>
                    <Run Text="Perfect for indi-allsky, AllSky, or any web-hosted all-sky camera"/>
                </TextBlock>
                <TextBlock Text="Username (optional):" Margin="0,10,0,2"/>
                <TextBox Text="{Binding Options.RtspUsername, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Width="300" HorizontalAlignment="Left"/>
                <TextBlock Text="Password (optional):" Margin="0,5,0,2"/>
                <PasswordBox Width="300" HorizontalAlignment="Left"
                             Loaded="HttpPasswordBox_Loaded"
                             PasswordChanged="HttpPasswordBox_PasswordChanged"/>
            </StackPanel>

            <!-- Folder Path (visible when mode = 2) -->
            <StackPanel Margin="0,0,0,10">
                <StackPanel.Visibility>
                    <Binding Path="Options.CaptureMode" Converter="{StaticResource EnumToVisibilityConverter}" ConverterParameter="2"/>
                </StackPanel.Visibility>
                <TextBlock Text="Folder Path:" Margin="0,0,0,2"/>
                <DockPanel>
                    <Button Content="Browse..." DockPanel.Dock="Right" Margin="5,0,0,0" Padding="10,2"
                            Click="BrowseFolder_Click"/>
                    <TextBox Text="{Binding Options.FolderPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                             VerticalContentAlignment="Center"/>
                </DockPanel>
                <TextBlock Text="Folder containing latest all-sky images" FontSize="10" Foreground="#AAAAAA" Margin="0,2,0,0"/>
            </StackPanel>

            <!-- Analysis Provider -->
            <TextBlock Text="Analysis Provider:" Margin="0,10,0,2" FontWeight="Bold"/>
            <ComboBox ItemsSource="{Binding ProviderOptions}"
                      DisplayMemberPath="Name"
                      SelectedValuePath="Id"
                      SelectedValue="{Binding AnalysisProvider, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Width="300" HorizontalAlignment="Left"/>
            
            <!-- Check Interval -->
            <TextBlock Text="Check Interval (minutes):" Margin="0,0,0,2"/>
            <TextBox Text="{Binding CheckIntervalMinutes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                     Width="100" HorizontalAlignment="Left"/>
            
            <!-- Cloud Coverage Threshold -->
            <TextBlock Text="Cloud Coverage Threshold (%):" Margin="0,10,0,2"/>
            <TextBox Text="{Binding CloudCoverageThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                     Width="100" HorizontalAlignment="Left"/>

                    <!-- Generic File SafetyMonitor output file -->
                    <TextBlock Text="Generic File SafetyMonitor" Margin="0,20,0,2" FontWeight="Bold"/>
                    <TextBlock Text="Write Safe/Unsafe status file:" Margin="0,0,0,6"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" HorizontalAlignment="Left">
                    <CheckBox IsChecked="{Binding Options.WriteSafetyStatusFile, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          VerticalAlignment="Center"
                          Width="64"
                          Margin="0,0,8,0"/>
                    <TextBox Text="{Binding Options.SafetyStatusFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         IsEnabled="{Binding Options.WriteSafetyStatusFile}"
                         Width="360"
                         VerticalContentAlignment="Center"/>
                    <Button Content="Browse..."
                        Margin="8,0,0,0"
                        Padding="10,2"
                        IsEnabled="{Binding Options.WriteSafetyStatusFile}"
                        Click="BrowseSafetyStatusFile_Click"/>
                    </StackPanel>
                    <TextBlock Text="Writes a single line: Safe or Unsafe" FontSize="10" Foreground="#AAAAAA" Margin="0,0,0,4"/>
                    <TextBlock Text="Point your ASCOM Generic File SafetyMonitor to this file" FontSize="10" Foreground="#AAAAAA" Margin="0,0,0,8"/>
            
            <!-- GitHub Models Token -->
            <StackPanel Margin="0,10,0,0"
                        Visibility="{Binding IsGitHubModelsProvider, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="GitHub Personal Access Token:" Margin="0,0,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <PasswordBox Width="360"
                                 HorizontalAlignment="Left"
                                 Loaded="GitHubTokenBox_Loaded"
                                 PasswordChanged="GitHubTokenBox_PasswordChanged"/>
                    <Button Content="Try"
                            Margin="8,0,0,0"
                            Padding="10,2"
                            Click="TryToken_Click"/>
                </StackPanel>
                <TextBlock Text="{Binding GitHubTokenStatus}" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
            </StackPanel>

            <!-- OpenAI Key -->
            <StackPanel Margin="0,10,0,0"
                        Visibility="{Binding IsOpenAIProvider, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="OpenAI API Key:" Margin="0,0,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <PasswordBox Width="360"
                                 HorizontalAlignment="Left"
                                 Loaded="OpenAIKeyBox_Loaded"
                                 PasswordChanged="OpenAIKeyBox_PasswordChanged"/>
                    <Button Content="Try"
                            Margin="8,0,0,0"
                            Padding="10,2"
                            Click="TryOpenAIKey_Click"/>
                </StackPanel>
                <TextBlock Text="{Binding OpenAIKeyStatus}" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
                <TextBlock Text="Used with https://api.openai.com" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
            </StackPanel>

            <!-- Gemini Key -->
            <StackPanel Margin="0,10,0,0"
                        Visibility="{Binding IsGeminiProvider, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="Google Gemini API Key:" Margin="0,0,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <PasswordBox Width="360"
                                 HorizontalAlignment="Left"
                                 Loaded="GeminiKeyBox_Loaded"
                                 PasswordChanged="GeminiKeyBox_PasswordChanged"/>
                    <Button Content="Try"
                            Margin="8,0,0,0"
                            Padding="10,2"
                            Click="TryGeminiKey_Click"/>
                </StackPanel>
                <TextBlock Text="{Binding GeminiKeyStatus}" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
                <TextBlock Text="Used with Generative Language API" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
            </StackPanel>

            <!-- Anthropic Key -->
            <StackPanel Margin="0,10,0,0"
                        Visibility="{Binding IsAnthropicProvider, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="Anthropic API Key:" Margin="0,0,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <PasswordBox Width="360"
                                 HorizontalAlignment="Left"
                                 Loaded="AnthropicKeyBox_Loaded"
                                 PasswordChanged="AnthropicKeyBox_PasswordChanged"/>
                    <Button Content="Try"
                            Margin="8,0,0,0"
                            Padding="10,2"
                            Click="TryAnthropicKey_Click"/>
                </StackPanel>
                <TextBlock Text="{Binding AnthropicKeyStatus}" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
                <TextBlock Text="Used with https://api.anthropic.com" Margin="0,4,0,0" FontSize="10" Foreground="#AAAAAA"/>
            </StackPanel>
            
                <!-- Model Selection (non-local providers) -->
                <StackPanel Margin="0,10,0,0"
                    Visibility="{Binding IsNonLocalProvider, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="AI Model:" Margin="0,0,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <ComboBox x:Name="ModelComboBox"
                          ItemsSource="{Binding AvailableModels}"
                          SelectedItem="{Binding SelectedModel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          IsEditable="True"
                          Width="300"
                          HorizontalAlignment="Left"
                          Loaded="ModelComboBox_Loaded"/>
                    <Button Content="Refresh"
                        Margin="8,0,0,0"
                        Padding="10,2"
                        Click="RefreshModels_Click"
                        Visibility="{Binding IsGitHubModelsProvider, Converter={StaticResource BoolToVisibility}}"/>
                </StackPanel>

                <TextBlock Text="{Binding ModelsStatus}"
                       Margin="0,4,0,0"
                       FontSize="10"
                       Foreground="#AAAAAA"
                       Visibility="{Binding IsGitHubModelsProvider, Converter={StaticResource BoolToVisibility}}"/>
                </StackPanel>
            
            <!-- Description Section -->
            <TextBlock Text="About AI Weather" FontWeight="Bold" Margin="0,20,0,10"/>
            <TextBlock Text="AI Weather analyzes all-sky camera images using artificial intelligence to determine real-time weather conditions and protect your equipment during unattended imaging sessions."
                       Margin="0,0,0,10" TextWrapping="Wrap" Width="500" HorizontalAlignment="Left"/>

            <TextBlock Text="How It Works" FontWeight="Bold" Margin="0,5,0,5"/>
            <TextBlock Text="The plugin periodically captures an image from your all-sky camera, sends it to a vision-capable AI model, and receives a structured weather assessment including cloud coverage percentage, weather condition, and rain/fog detection. Based on configurable thresholds, it reports a Safe or Unsafe status to NINA's safety monitor, which can automatically pause or abort an imaging sequence."
                       Margin="0,0,0,10" TextWrapping="Wrap" Width="500" HorizontalAlignment="Left"/>

            <TextBlock Text="Capture Modes" FontWeight="Bold" Margin="0,5,0,5"/>
            <StackPanel Margin="15,0,0,10">
                <TextBlock Text="○   RTSP Stream - live video from network IP cameras with real-time preview" Margin="0,3"/>
                <TextBlock Text="○   HTTP Image - periodic download from a URL (indi-allsky, AllSky, web cameras)" Margin="0,3"/>
                <TextBlock Text="○   Folder Watch - monitors a local folder for the latest image saved by any camera software" Margin="0,3"/>
            </StackPanel>

            <TextBlock Text="AI Providers" FontWeight="Bold" Margin="0,5,0,5"/>
            <StackPanel Margin="15,0,0,10">
                <TextBlock Text="○   Local - offline heuristic analysis using brightness, color, and pattern detection" Margin="0,3"/>
                <TextBlock Text="○   GitHub Models - free access to GPT-4o, Claude, Gemini via GitHub token" Margin="0,3"/>
                <TextBlock Text="○   OpenAI - GPT-4o and GPT-4o Mini" Margin="0,3"/>
                <TextBlock Text="○   Google Gemini - Gemini 1.5 Flash, 1.5 Pro, 2.0 Flash" Margin="0,3"/>
                <TextBlock Text="○   Anthropic Claude - Claude 3.5 Sonnet, 3.5 Haiku, 3 Opus" Margin="0,3"/>
            </StackPanel>

            <TextBlock Text="Safety Features" FontWeight="Bold" Margin="0,5,0,5"/>
            <StackPanel Margin="15,0,0,10">
                <TextBlock Text="○   Detects cloud coverage, rain (including lens droplets), and fog" Margin="0,3"/>
                <TextBlock Text="○   Rain and fog trigger Unsafe regardless of cloud threshold" Margin="0,3"/>
                <TextBlock Text="○   Automatic fallback to local analysis if the AI provider fails or times out" Margin="0,3"/>
                <TextBlock Text="○   Optional status file output for ASCOM Generic File SafetyMonitor integration" Margin="0,3"/>
            </StackPanel>

            <TextBlock Text="Connect the safety monitor under Equipment > Safety Monitor > All Sky Camera Safety Monitor to start protecting your imaging sessions."
                       Margin="0,0,0,0" TextWrapping="Wrap" Width="500" HorizontalAlignment="Left" FontSize="11" Foreground="#AAAAAA"/>
        </StackPanel>
    </DataTemplate>
    
</ResourceDictionary>
